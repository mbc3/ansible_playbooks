---
- name: Populate service facts
  ansible.builtin.service_facts:
- name: Add Prometheus Node Exporter service to firewalld
  ansible.posix.firewalld:
    service: "{{ item }}"
    state: enabled
    immediate: true
    permanent: true
  loop: "{{ prometheus_client_ports }}"
  when: ansible_facts.services['firewalld.service'].status is defined
- name: Enable prometheus-node-exporter
  ansible.builtin.systemd_service:
    name: prometheus-node-exporter
    enabled: true
    state: started
- name: Add systemd and process collector
  ansible.builtin.lineinfile:
    path: /etc/default/prometheus-node-exporter
    regexp: "^ARGS="
    line: 'ARGS="--collector.systemd --collector.processes"'
  notify: Restart prometheus-node-exporter
